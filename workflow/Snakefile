#from prep_inputs import * 
from utils import *
import random
from pathlib import Path
import json
import sys
import logging
import shutil
from datetime import datetime
import pytz as tz

include: "rules/common.smk" # <---- generates all the configuration variables and most importantly, sample_barcode_maps

workdir: working_dir # <----- working directory is specified by prep_inputs.py; it is the cohort directory

rule all:
    input:
        # # step0
        #expand('{sample_name}/rename_confirm.txt', sample_name = sample_names),
        # ---- step-1 output:
        # get_step1_sc_bams(sample_names, sample_barcode_maps),
        # # ---- step-2 output:
        # get_step2_filter_added_mutect2_vcfs(sample_names, sample_barcode_maps),
        # # #get_step2_strelka2_vcfs(sample_names, sample_barcode_maps),
        # # # ---- step-3 output:
        # # expand("{sample_name}/3-bcf_filter/combined_vcf/{sample_name}-combined_VCF_filter_v3.prev_filtered.vcf.gz", sample_name = sample_names),
        # # # ---- step-4 output:
        # (A) bcftools mpileup:
        # expand("{sample_name}/4-bcf_genotyping/combined_vcf/{sample_name}-combined_VCF.filtered.vcf.gz.stats", sample_name = sample_names),
        # ---------------------
        # (B) Mutect2 force call:
        expand("{sample_name}/4-sc_mutect_f_call/{sample_name}-f_q_intersected.vcf.gz.stats", sample_name = sample_names),
        # # ---- step-5 output:
        # expand("{sample_name}/OUTPUTS_from_mpileup/{sample_name}_DNA_CNV_bcf_mpileup.h5", sample_name = sample_names),
        # expand("{sample_name}/OUTPUTS_from_m2_f/{sample_name}_DNA_CNV_m2_f.h5", sample_name = sample_names)
        # # ---- step-6 output:
        expand("{sample_name}/OUTPUTS_from_m2_f/{sample_name}_DNA_CNV_m2_f.cravat_annotated.h5", sample_name = sample_names)
        expand("{sample_name}/OUTPUTS_from_m2_f/annotations/{sample_name}_CRAVAT_output.cleaned.txt", sample_name = sample_names)
        
# include: "rules/0-run_tap_pipeline.smk"
# include: "rules/1-split_sc_bams.smk"
# include: "rules/2-single-cell_mutect2_call.smk"
# include: "rules/3-filter_and_merge_sc_m2_call.smk"
# include: "rules/4-single-cell_mpileup.smk"
include: "rules/4-single-cell_mutect2_force_call.smk"
# include: "rules/4.5-filter_and_combine_sc_m2_f_calls.smk"  # <---- deprecated?
include: "rules/5-generate_outputs.smk"
include: "rules/6-annotate_outputs.smk"