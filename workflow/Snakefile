# @HZ 10/01/2022:
# common v2:
# read config file, get patient&sample info 
include: "/home/zhangh5/work/Tapestri_project/TapVarCallSmk/workflow/common_v2.smk"

workdir: working_dir 

rule all:
    input:
        # ===== single_sample workflow =====
        # ---- step-1 output:
        # get_step1_sc_bams(sample_names, sample_barcode_maps),
        # # ---- step-2 output:
        # get_step2_filter_added_mutect2_vcfs(sample_names, sample_barcode_maps),
        # # #get_step2_strelka2_vcfs(sample_names, sample_barcode_maps),
        # ---- step-3 output:
        # expand("{sample_name}/3-bcf_filter/combined_vcf/{sample_name}-combined_VCF_filter_v3.prev_filtered.vcf.gz", sample_name = sample_names),
        expand("{sample_name}/3-bcf_filter/merged_bq_info/{sample_name}-bq_merged.sc_prev.csv", sample_name = sample_names),
        # ---- step-4 output:
        # (A) bcftools mpileup:
        # expand("{sample_name}/4-bcf_genotyping/{sample_name}.mpileup.DP.merged.csv", sample_name = sample_names),
        # ---------------------
        # (B) Mutect2 force call:
        # expand("{sample_name}/4-sc_mutect_f_call/{sample_name}-f_q_intersected.vcf.gz.stats", sample_name = sample_names),
        # # ---- step-5 output:
        # (A) bcftools mpileup:
        expand("{sample_name}/OUTPUTS_from_mpileup/{sample_name}.mpileup.h5",sample_name = sample_names),
        expand("{sample_name}/OUTPUTS_from_mpileup/{sample_name}.mpileup.prev_filtered.csv",sample_name = sample_names),
        # # (B) Mutect2 force call:
        # expand("{sample_name}/OUTPUTS_from_m2_f/{sample_name}_DNA_CNV_m2_f.h5", sample_name = sample_names),

        # ===== patient_wide workflow =====
        expand(
            "fillout/input/{patient_name}.snv_union.for_genotyping.vcf.gz",
            patient_name = patient_name
        ),
        expand(
            "fillout/{sample_name}/{sample_name}.mpileup.DP.merged.csv",
            sample_name=sample_names
        ),
        expand(
            "fillout/{sample_name}/{sample_name}.mpileup.h5",
            sample_name=sample_names
        ),
        expand("fillout/{patient_name}.patient_wide.genotyped.h5", patient_name = patient_name),

        
